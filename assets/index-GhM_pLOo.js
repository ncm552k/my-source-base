import{u as Y,r as g,a as z,j as e,B as X,b as H,c as $,d as W,e as L,f as Z,A as J}from"./index-ZyA5Mrcr.js";import{u as G,F as p,I as _,l as ee}from"./Input-BKVXcAzA.js";import{C as E}from"./messages-BrD-ntZi.js";import{C as te,M as q,E as ae,P as ne,a as k}from"./regex-BJRGyeGg.js";import{h as se,Q as re,a as f,u as ie,b as F,l as le,D as M,M as I,N as j,T as oe,S as ce,U as de,d as b,c as pe,I as U,E as me,e as ue}from"./EditIcon-zZKgeQcI.js";import{r as he,M as Ee,E as xe,P as ye,C as O}from"./helper-C5cr0rGy.js";import{A as Te,T as ge,I as Me}from"./Table-Cc5NRMje.js";import{M as Se}from"./Modal-cp0zEIK2.js";import{S as C,T as Ie,D as w}from"./dates-BEb3NdOs.js";const D=se(re.QUAN_LY_METRIC,{getList:t=>[t]}),A="/metrics",_e=t=>f({method:"GET",url:A,params:{...t,pageNo:t.pageNo-1}}),fe=t=>f({method:"POST",url:A,data:t}),Ae=(t,s)=>f({method:"PUT",url:`${A}/${t}`,data:s}),Ne=t=>f({method:"DELETE",url:`${A}/${t}`}),Q=t=>ie({queryKey:D.getList(t).queryKey,queryFn:async()=>(await _e(t)).data}),Ce=({onSuccess:t})=>F({mutationFn:async s=>{await Ne(s)},onSuccess:()=>{t()}}),je=({onSuccess:t})=>F({mutationFn:async s=>{await fe(s)},onSuccess:()=>{t()}}),De=({onSuccess:t})=>F({mutationFn:async({id:s,...a})=>{await Ae(s,a)},onSuccess:()=>{t()}}),n={name:{label:"Tên metric",placeholder:"Nhập tối đa 255 ký tự",name:"name"},code:{label:"Mã metric",placeholder:"Nhập tối đa 255 ký tự",name:"code"},type:{label:"Phân loại",placeholder:"Chọn phân loại",name:"type"},unit:{label:"Đơn vị",placeholder:"Nhập tối đa 50 ký tự (VD. đồng)...",name:"unit"},description:{label:"Mô tả",placeholder:"Nhập tối đa 1000 ký tự...",name:"description"},expectedTrend:{label:"Xu thế kỳ vọng",placeholder:"Chọn xu thế kỳ vọng",name:"expectedTrend"},periodType:{label:"Loại kỳ đánh giá",placeholder:"Chọn loại kỳ đánh giá",name:"periodType"}},x={keySearch:{label:"Từ khoá",placeholder:"Nhập từ khoá để tìm kiếm",name:"keySearch"},type:{label:"Phân loại",placeholder:"Chọn phân loại",name:"type"}},Fe={pageNo:M.PAGE_NO,pageSize:M.PAGE_SIZE,keySearch:void 0,type:void 0},R=()=>le({defaultState:Fe}),Re=({formType:t,closeModal:s,editObject:a,...o})=>{const c=Y(m=>m.setConfirmModalProps),[d,h]=g.useState(),{urlState:y}=R(),u=z(),[i]=G(),{mutate:N,isPending:r}=je({onSuccess:()=>{j.success("Thêm mới metric thành công!"),s(),u.invalidateQueries({queryKey:D.getList(y).queryKey})}}),{mutate:l,isPending:S}=De({onSuccess:()=>{j.success("Chỉnh sửa metric thành công!"),s(),u.invalidateQueries({queryKey:D.getList(y).queryKey})}}),T=g.useMemo(()=>({code:[{required:!0,message:E.REQUIRED_MESSAGE},{pattern:te,message:'Mã metric không được bao gồm các ký tự khác chữ, số và dấu "_"'}],name:[{required:!0,message:E.REQUIRED_MESSAGE}],type:[{required:!0,message:E.REQUIRED_MESSAGE}],expectedTrend:[{required:!0,message:E.REQUIRED_MESSAGE}],unit:[{required:!!d?.isRequiredUnit,message:E.REQUIRED_MESSAGE}],periodType:[{required:!0,message:E.REQUIRED_MESSAGE}]}),[d]),B=m=>{a?l({...m,id:a.id}):N({...m})},v=()=>{i.submit()},K=()=>{if(i.isFieldsTouched()){c({open:!0,message:E.FORM_EXIT_MESSAGE,onOk:()=>{s()}});return}s()},V=()=>{i.resetFields(),h(void 0)},P=m=>{if(m===k.NUMBER||m===k.PERCENTAGE){h({isRequiredUnit:!0});return}h({isRequiredUnit:!1})};return g.useEffect(()=>{a&&(i.setFieldValue("name",a?.name),i.setFieldValue("code",a?.code),i.setFieldValue("type",a?.type),i.setFieldValue("description",a?.description),i.setFieldValue("unit",a?.unit),i.setFieldValue("expectedTrend",a?.expectedTrend),i.setFieldValue("periodType",a?.periodType),P(a?.type))},[a,i]),e.jsx(Se,{size:"sm",title:t==="ADD"?"Thêm mới metric":"Chỉnh sửa metric",onOk:v,onCancel:K,afterClose:V,okButtonProps:{loading:r||S},...o,children:e.jsxs(p,{layout:"vertical",form:i,onFinish:B,children:[e.jsx(p.Item,{name:n.name.name,label:n.name.label,rules:T.name,children:e.jsx(_,{placeholder:n.name.placeholder,formKey:n.name.name,maxLength:I.TWO_HUNDRED_FIFTY_FIVE})}),e.jsx(p.Item,{name:n.code.name,label:n.code.label,rules:T.code,normalize:m=>he(m).toUpperCase(),children:e.jsx(_,{placeholder:n.code.placeholder,formKey:n.code.name,maxLength:I.TWO_HUNDRED_FIFTY_FIVE})}),e.jsx(p.Item,{name:n.type.name,label:n.type.label,rules:T.type,children:e.jsx(C,{placeholder:n.type.placeholder,options:q,onChange:P})}),e.jsx(p.Item,{name:n.unit.name,label:n.unit.label,rules:T.unit,children:e.jsx(_,{placeholder:n.unit.placeholder,formKey:n.unit.name,maxLength:I.FIFTY})}),e.jsx(p.Item,{name:n.description.name,label:n.description.label,children:e.jsx(Ie,{placeholder:n.description.placeholder,maxLength:I.ONE_THOUSAND,formKey:n.description.name,className:"!resize-none",rows:3})}),e.jsx(p.Item,{name:n.expectedTrend.name,label:n.expectedTrend.label,rules:T.expectedTrend,children:e.jsx(C,{placeholder:n.expectedTrend.placeholder,options:ae})}),e.jsx(p.Item,{name:n.periodType.name,label:n.periodType.label,rules:T.periodType,className:"mb-0",children:e.jsx(C,{placeholder:n.periodType.placeholder,options:ne})})]})})},Pe=({handleOpenFormAdd:t})=>{const[s]=G(),{urlState:a,setUrl:o}=R(),{isLoading:c,refetch:d}=Q(a),h=y=>{const u={...y,pageNo:M.PAGE_NO,pageSize:M.PAGE_SIZE};if(ee.isEqual(u,a)){d();return}o(u)};return e.jsx("div",{className:"mb-5",children:e.jsx(p,{layout:"vertical",form:s,onFinish:h,children:e.jsxs("div",{className:"flex gap-x-6 gap-y-4 items-end flex-wrap form-no-margin",children:[e.jsx(p.Item,{label:x.keySearch?.label,name:x.keySearch.name,initialValue:a.keySearch,className:"min-w-[270px] w-[18%]",children:e.jsx(_,{formKey:x.keySearch.name,placeholder:x.keySearch?.placeholder,maxLength:I.ONE_THOUSAND})}),e.jsx(p.Item,{label:x.type?.label,name:x.type.name,initialValue:a.type,className:"min-w-[270px] w-[18%]",children:e.jsx(oe,{placeholder:x.type?.placeholder,options:q})}),e.jsx(X,{type:"primary",htmlType:"submit",icon:e.jsx(ce,{}),loading:c,children:"Tìm kiếm"}),e.jsx(H,{type:"primary",icon:e.jsx(Te,{}),onClick:t,children:"Thêm mới metrics"}),e.jsx($,{type:"primary",icon:e.jsx(de,{}),onClick:b,children:"Nhập file .xlsx"}),e.jsx(W,{type:"primary",icon:e.jsx(pe,{}),onClick:b,children:"Xuất file .xlsx"})]})})})},Le=({handleOpenFormEdit:t})=>{const[s,a]=g.useState({open:!1,onCancel:()=>a({...s,open:!1}),confirmTitle:"Bạn có chắc chắn muốn xoá metric"}),{urlState:o,setUrl:c}=R(),{data:d,isLoading:h,refetch:y}=Q(o),{mutate:u}=Ce({onSuccess:()=>{j.success("Xoá metric thành công !"),a(r=>({...r,open:!1})),y()}}),i=g.useMemo(()=>[{title:"STT",ellipsis:!0,width:60,render:(r,l,S)=>e.jsx(e.Fragment,{children:o.pageSize*(o.pageNo-1)+S+1})},{title:"Mã metric",dataIndex:"code",ellipsis:!0,width:170},{title:"Tên metric",dataIndex:"name",ellipsis:!0,width:245},{title:"Phân loại",dataIndex:"type",ellipsis:!0,width:110,render:r=>e.jsx(e.Fragment,{children:Ee[r]})},{title:"Đơn vị",dataIndex:"unit",ellipsis:!0,width:100},{title:"Mô tả",dataIndex:"description",ellipsis:!0,width:270},{title:"Xu thế kỳ vọng",dataIndex:"expectedTrend",ellipsis:!0,width:130,render:r=>e.jsx(e.Fragment,{children:xe[r]})},{title:"Kỳ đánh giá",dataIndex:"periodType",ellipsis:!0,width:120,render:r=>e.jsx(e.Fragment,{children:ye[r]})},{title:"Người tạo",ellipsis:!0,width:165,render:(r,l)=>e.jsxs(e.Fragment,{children:[e.jsx("p",{children:l.createdBy}),e.jsx("p",{className:"text-disabled",children:L(l.createdAt).format(w)})]})},{title:"Người cập nhật",ellipsis:!0,width:165,render:(r,l)=>e.jsxs(e.Fragment,{children:[e.jsx("p",{children:l.updatedBy}),e.jsx("p",{className:"text-disabled",children:L(l.updatedAt).format(w)})]})},{title:"Thao tác",dataIndex:"stt",ellipsis:!0,width:140,render:(r,l)=>e.jsxs(e.Fragment,{children:[e.jsx(U,{icon:e.jsx(me,{}),tooltip:O.EDIT,className:"mr-4",onClick:()=>{t(l)}}),e.jsx(U,{icon:e.jsx(ue,{}),tooltip:O.DELETE,onClick:()=>{a(S=>({...S,open:!0,message:`${l.code} - ${l.name}`,onOk:()=>{u(l.id)}}))}})]})}],[t,u,o.pageNo,o.pageSize]),N=r=>{c({...o,pageNo:r.current||M.PAGE_NO,pageSize:r.pageSize||M.PAGE_SIZE})};return e.jsxs(e.Fragment,{children:[e.jsx(ge,{columns:i,dataSource:d?.data,loading:h,pagination:{pageSize:d?.pageInfo.pageSize,current:d?.pageInfo.pageNo,total:d?.pageInfo.totalCount},onChange:N,scroll:{x:1600,y:500},sticky:!0,rowKey:"id"}),e.jsx(Me.Delete,{...s})]})},ve=()=>{Z(J.QUAN_LY_METRIC,["QUAN_LY_DANH_GIA","QUAN_LY_METRIC"]);const[t,s]=g.useState({open:!1,formType:"ADD",closeModal:()=>{s(c=>({...c,open:!1,editObject:void 0}))}}),a=()=>{s(c=>({...c,formType:"ADD",open:!0}))},o=c=>{s(d=>({...d,formType:"EDIT",open:!0,editObject:c}))};return e.jsxs("div",{className:"rounded-2xl bg-white px-4 py-5",children:[e.jsx(Pe,{handleOpenFormAdd:a}),e.jsx(Le,{handleOpenFormEdit:o}),e.jsx(Re,{...t})]})};export{ve as default};
