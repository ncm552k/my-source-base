import{e as g,g as V,j as e,C as Q,S as p,r as D,u as X,a as $,B as Z,b as J,c as ee,d as ae,f as te,A as ne}from"./index-ZyA5Mrcr.js";import{a as oe,u as H,F as E,I as M,l as re}from"./Input-BKVXcAzA.js";import{a as y,S as se,T as ie,D as v}from"./dates-BEb3NdOs.js";import{C as I}from"./messages-BrD-ntZi.js";import{C as le,P as K}from"./regex-BJRGyeGg.js";import{h as de,Q as ce,a as j,u as me,b as L,l as ue,D as f,M as N,N as O,T as pe,S as he,U as ge,d as U,c as Ee,I as w,E as _e,e as xe}from"./EditIcon-zZKgeQcI.js";import{r as ye,P as De,C as B}from"./helper-C5cr0rGy.js";import{D as Y,a as z}from"./DatePickerIcon-BgrfxyiM.js";import{A as fe,T as Te,I as Ae}from"./Table-Cc5NRMje.js";import{M as Ie}from"./Modal-cp0zEIK2.js";const Se=(a,t)=>a[0].isSameOrAfter(a[1].clone().subtract(t-1,"day"),"date"),Pe=(a,t)=>{if(!(!a||!t))return[g(a),g(t)]},Ne=({...a})=>{const[t]=V();return e.jsx(Q,{theme:{token:{...t,colorBgBase:p.color_gray_100,colorBorder:p.color_gray_100},components:{DatePicker:{hoverBorderColor:p.color_gray_500,activeBorderColor:p.color_gray_500,activeShadow:p.none,errorActiveShadow:p.none,colorTextPlaceholder:p.color_gray_500,paddingInline:19,cellHeight:24,cellWidth:36,textHeight:40}}},children:e.jsx(Y.RangePicker,{suffixIcon:e.jsx(z,{}),placeholder:["Từ ngày","Đến ngày"],format:y,inputReadOnly:!0,...a})})},k=(a,t,n)=>a.isAfter(t.clone().add(n-1,"day"),"date")||a.isBefore(t.clone().subtract(n-1,"day"),"date"),je=({limitDays:a,...t})=>{const[n]=V(),m=oe(),[i,o]=D.useState(),[_,u]=D.useState(),h=m.getFieldValue("rangeDate"),T=(d,S,F)=>{if(F.range==="start"){o({value:d[0],type:"start"});return}o({value:d[1],type:"end"})},A=d=>i?i.type==="start"&&_==="start"?h?k(d,h[1],a):!1:i.type==="end"&&_==="end"?h?k(d,h[0],a):!1:k(d,i.value,a):!1,l=(d,S)=>{u(S.range)},r=d=>{d||(u(void 0),o(void 0))};return e.jsx(Q,{theme:{token:{...n,colorBgBase:p.color_gray_100,colorBorder:p.color_gray_100},components:{DatePicker:{hoverBorderColor:p.color_gray_500,activeBorderColor:p.color_gray_500,activeShadow:p.none,errorActiveShadow:p.none,colorTextPlaceholder:p.color_gray_500,paddingInline:19,cellHeight:24,cellWidth:36,textHeight:40}}},children:e.jsx(Y.RangePicker,{suffixIcon:e.jsx(z,{}),inputReadOnly:!0,placeholder:["Từ ngày","Đến ngày"],onCalendarChange:T,format:y,disabledDate:A,onOpenChange:r,onFocus:l,...t})})},b=de(ce.QUAN_LY_CHU_KY_DANH_GIA,{getList:a=>[a]}),C="/evaluation/period",Ce=a=>j({method:"GET",url:C,params:{...a,pageNo:a.pageNo-1}}),Fe=a=>j({method:"POST",url:C,data:a}),ke=(a,t)=>j({method:"PUT",url:`${C}/${a}`,data:t}),Me=a=>j({method:"DELETE",url:C,params:{id:a}}),q=a=>me({queryKey:b.getList(a).queryKey,queryFn:async()=>(await Ce(a)).data}),Oe=({onSuccess:a})=>L({mutationFn:async t=>{await Me(t)},onSuccess:()=>{a()}}),be=({onSuccess:a})=>L({mutationFn:async t=>{await Fe(t)},onSuccess:()=>{a()}}),Le=({onSuccess:a})=>L({mutationFn:async({id:t,...n})=>{await ke(t,n)},onSuccess:()=>{a()}}),s={code:{name:"code",label:"Mã kỳ",placeholder:"Nhập tối đa 255 ký tự..."},name:{name:"name",label:"Tên kỳ",placeholder:"Nhập tối đa 255 ký tự..."},periodType:{name:"periodType",label:"Loại kỳ",placeholder:"Chọn loại kỳ"},rangeDate:{name:"rangeDate",label:"Thời gian"},description:{name:"description",label:"Mô tả",placeholder:"Nhập tối đa 1000 ký tự..."}},x={name:{name:"name",label:"Từ khoá",placeholder:"Nhập từ khoá để tìm kiếm"},type:{name:"type",label:"Phân loại",placeholder:"Chọn phân loại"},rangeDate:{name:"rangeDate",label:"Thời gian"}},G=365,Re={pageNo:f.PAGE_NO,pageSize:f.PAGE_SIZE,type:void 0,name:void 0,startDate:void 0,endDate:void 0},R=()=>ue({defaultState:Re}),ve=({formType:a,closeModal:t,editObject:n,...m})=>{const i=X(c=>c.setConfirmModalProps),[o]=H(),{urlState:_}=R(),u=$(),{mutate:h,isPending:T}=be({onSuccess:()=>{O.success("Thêm mới chu kỳ đánh giá thành công!"),t(),u.invalidateQueries(b.getList(_))}}),{mutate:A,isPending:l}=Le({onSuccess:()=>{O.success("Chỉnh sửa chu kỳ đánh giá thành công!"),t(),u.invalidateQueries(b.getList(_))}}),r=D.useMemo(()=>({code:[{required:!0,message:I.REQUIRED_MESSAGE},{pattern:le,message:'Mã kỳ không được bao gồm các ký tự khác chữ, số và dấu "_"'}],name:[{required:!0,message:I.REQUIRED_MESSAGE}],periodType:[{required:!0,message:I.REQUIRED_MESSAGE}],rangeDate:[{required:!0,message:I.REQUIRED_MESSAGE}]}),[]),d=c=>{const P={code:c.code,name:c.name,periodType:c.periodType,startDate:g(c.rangeDate[0]).format(y),endDate:g(c.rangeDate[1]).format(y),description:c.description};n?A({...P,id:n.id}):h(P)},S=()=>{o.submit()},F=()=>{if(o.isFieldsTouched()){i({open:!0,message:I.FORM_EXIT_MESSAGE,onOk:()=>{t()}});return}t()},W=()=>{o.resetFields()};return D.useEffect(()=>{n&&(o.setFieldValue("name",n?.name),o.setFieldValue("code",n?.code),o.setFieldValue("periodType",n?.periodType),o.setFieldValue("description",n?.description),o.setFieldValue("rangeDate",[g(n.startDate),g(n.endDate)]))},[n,o]),e.jsx(Ie,{size:"sm",title:a==="ADD"?"Thêm mới kỳ đánh giá":"Chỉnh sửa kỳ đánh giá",onOk:S,onCancel:F,afterClose:W,okButtonProps:{loading:T||l},...m,children:e.jsxs(E,{layout:"vertical",form:o,onFinish:d,children:[e.jsx(E.Item,{name:s.code.name,label:s.code.label,rules:r.code,normalize:c=>ye(c).toUpperCase(),children:e.jsx(M,{placeholder:s.code.placeholder,formKey:s.code.name,maxLength:N.TWO_HUNDRED_FIFTY_FIVE})}),e.jsx(E.Item,{name:s.name.name,label:s.name.label,rules:r.name,children:e.jsx(M,{placeholder:s.name.placeholder,formKey:s.name.name,maxLength:N.TWO_HUNDRED_FIFTY_FIVE})}),e.jsx(E.Item,{name:s.periodType.name,label:s.periodType.label,rules:r.periodType,children:e.jsx(se,{placeholder:s.periodType.placeholder,options:K})}),e.jsx(E.Item,{name:s.rangeDate.name,label:s.rangeDate.label,rules:r.rangeDate,normalize:(c,P)=>c&&(Se(c,G)?c:P),children:e.jsx(je,{limitDays:G,disabled:a==="EDIT"})}),e.jsx(E.Item,{name:s.description.name,label:s.description.label,className:"mb-0",children:e.jsx(ie,{placeholder:s.description.placeholder,maxLength:N.ONE_THOUSAND,formKey:s.description.name,className:"!resize-none",rows:3})})]})})},Ue=({handleOpenFormAdd:a})=>{const[t]=H(),{urlState:n,setUrl:m}=R(),{isLoading:i,refetch:o}=q(n),_=u=>{const h={pageNo:f.PAGE_NO,pageSize:f.PAGE_SIZE,name:u.name,type:u.type,startDate:u.rangeDate?g(u.rangeDate?.[0]).format(y):void 0,endDate:u.rangeDate?g(u.rangeDate?.[1]).format(y):void 0};if(re.isEqual(h,n)){o();return}m(h)};return e.jsx("div",{className:"mb-5",children:e.jsx(E,{layout:"vertical",form:t,onFinish:_,children:e.jsxs("div",{className:"flex gap-x-6 gap-y-4 items-end flex-wrap form-no-margin",children:[e.jsx(E.Item,{label:x.name?.label,name:x.name.name,initialValue:n.name,className:"min-w-[270px] w-[18%]",children:e.jsx(M,{formKey:x.name.name,placeholder:x.name?.placeholder,maxLength:N.ONE_THOUSAND})}),e.jsx(E.Item,{label:x.type?.label,name:x.type.name,initialValue:n.type,className:"min-w-[270px] w-[18%]",children:e.jsx(pe,{placeholder:x.type?.placeholder,options:K})}),e.jsx(E.Item,{label:x.rangeDate?.label,name:x.rangeDate.name,initialValue:Pe(n.startDate,n.endDate),className:"min-w-[270px] w-[18%]",children:e.jsx(Ne,{})}),e.jsx(Z,{type:"primary",htmlType:"submit",icon:e.jsx(he,{}),loading:i,children:"Tìm kiếm"}),e.jsx(J,{type:"primary",icon:e.jsx(fe,{}),onClick:()=>a(),children:"Thêm mới"}),e.jsx(ee,{type:"primary",icon:e.jsx(ge,{}),onClick:U,children:"Nhập file .xlsx"}),e.jsx(ae,{type:"primary",icon:e.jsx(Ee,{}),onClick:U,children:"Xuất file .xlsx"})]})})})},we=({handleOpenFormEdit:a})=>{const[t,n]=D.useState({open:!1,onCancel:()=>n({...t,open:!1}),confirmTitle:"Bạn có chắc chắn muốn xoá kỳ đánh giá"}),{urlState:m,setUrl:i}=R(),{data:o,isLoading:_,refetch:u}=q(m),{mutate:h}=Oe({onSuccess:()=>{O.success("Xoá chu kỳ đánh giá thành công !"),n(l=>({...l,open:!1})),u()}}),T=D.useMemo(()=>[{title:"STT",ellipsis:!0,width:60,render:(l,r,d)=>e.jsx(e.Fragment,{children:m.pageSize*(m.pageNo-1)+d+1})},{title:"Mã kỳ",dataIndex:"code",ellipsis:!0,width:170},{title:"Tên kỳ",dataIndex:"name",ellipsis:!0,width:245},{title:"Phân loại",dataIndex:"periodType",ellipsis:!0,width:110,render:l=>e.jsx(e.Fragment,{children:De[l]})},{title:"Mô tả",dataIndex:"description",ellipsis:!0,width:270},{title:"Thời gian",ellipsis:!0,width:185,render:(l,r)=>e.jsxs("p",{children:[g(r.startDate).format(y)," - ",g(r.startDate).format(y)]})},{title:"Người tạo",ellipsis:!0,width:170,render:(l,r)=>e.jsxs(e.Fragment,{children:[e.jsx("p",{children:r.createdBy}),e.jsx("p",{className:"text-disabled",children:g(r.createdAt).format(v)})]})},{title:"Người cập nhật",ellipsis:!0,width:166,render:(l,r)=>e.jsxs(e.Fragment,{children:[e.jsx("p",{children:r.updatedBy}),e.jsx("p",{className:"text-disabled",children:g(r.updatedAt).format(v)})]})},{title:"Thao tác",ellipsis:!0,width:140,render:(l,r)=>e.jsxs(e.Fragment,{children:[e.jsx(w,{icon:e.jsx(_e,{}),tooltip:B.EDIT,className:"mr-4",onClick:()=>{a(r)}}),e.jsx(w,{icon:e.jsx(xe,{}),tooltip:B.DELETE,onClick:()=>{n(d=>({...d,open:!0,message:`${r.code} - ${r.name}`,onOk:()=>{h(r.id)}}))}})]})}],[m.pageNo,m.pageSize,h]),A=l=>{i({...m,pageNo:l.current||f.PAGE_NO,pageSize:l.pageSize||f.PAGE_SIZE})};return e.jsxs(e.Fragment,{children:[e.jsx(Te,{columns:T,scroll:{x:1600,y:500},loading:_,onChange:A,dataSource:o?.data,pagination:{pageSize:o?.pageInfo.pageSize,current:o?.pageInfo.pageNo,total:o?.pageInfo.totalCount}}),e.jsx(Ae.Delete,{...t})]})},Xe=()=>{te(ne.QUAN_LY_CHU_KY_DANH_GIA,["QUAN_LY_DANH_GIA","QUAN_LY_CHU_KY_DANH_GIA"]);const[a,t]=D.useState({open:!1,formType:"ADD",closeModal:()=>{t(i=>({...i,open:!1,editObject:void 0}))}}),n=()=>{t(i=>({...i,formType:"ADD",open:!0}))},m=i=>{t(o=>({...o,formType:"EDIT",open:!0,editObject:i}))};return e.jsxs("div",{className:"rounded-2xl bg-white px-4 py-5",children:[e.jsx(Ue,{handleOpenFormAdd:n}),e.jsx(we,{handleOpenFormEdit:m}),e.jsx(ve,{...a})]})};export{Xe as default};
